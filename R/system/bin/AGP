#!/bin/sh
echo ""
echo "*****************************************"
echo "*      RiProG Open Source @RiOpSo       *"
echo "*****************************************"
echo "*                                       *"
echo "*             Muhammad Rizki            *"
echo "* Telegram: @RiProG | Github: RiProG-ID *"
echo "*                                       *"
echo "*****************************************"
echo ""
sleep 2
if [ "$1" = all ]; then
package_list=$(cmd package list packages | cut -f 2 -d :)
else
package_list=$(cmd package list packages -3 | cut -f 2 -d :)
fi
gamelist=/data/adb/modules/Priority/gamelist.txt
sleep 2
while true; do
  echo ""
  printf "\033[1mAllGame Priority Menu\033[0m"
  echo ""
  echo "Select app to add in gamelist:"
  echo ""
  count=1
  for package in $package_list; do
    status=$(grep "$package" "$gamelist")
    if [ -z "$status" ]; then
      printf "\033[31m%s. %s\033[0m\n" "$count" "$package"
    else
      printf "\033[32m%s. %s\033[0m\n" "$count" "$package"
    fi
    count=$((count + 1))
  done
  echo ""
  if [ $(echo "$package_list" | grep bellavita.toast) ]; then
  printf "\033[31m%s. %s\033[0m\n" "$count" "Toast"
  else
  printf "\033[32m%s. %s\033[0m\n" "$count" "Toast"
  fi
  count=$((count + 1))
  echo ""
  echo "$count. exit"
  echo ""
  echo "Select number:"
  echo
  read choice
  if [ "$choice" = "$count" ]; then
    echo ""
    echo "Changes will take effect after the next reboot"
    echo ""
    exit 0
    elif [ "$choice" = "$((count - 1))" ]; then
    toast=$(pm list package -d | grep bellavita.toast)
    if [ -z "$toast" ]; then
      pm disable bellavita.toast >/dev/null 2>&1
    else
      pm enable bellavita.toast >/dev/null 2>&1
    fi
  elif [ "$choice" -ge 1 ] && [ "$choice" -lt "$count" ]; then
    package=$(echo $package_list | cut -d ' ' -f "$choice")
    status=$(cat "$gamelist" | grep "$package")
    if [ "$status" ]; then
      sed -i "/$package/d" "$gamelist"
    else
      echo "$package" >> "$gamelist"
    fi
  else
    echo "invalid select"
  fi
  echo ""
  sleep 2
done
